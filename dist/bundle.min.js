Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.maxIndex=function(){return this.indexOf(Math.max.apply(null,this))},Array.prototype.minIndex=function(){return this.indexOf(Math.min.apply(null,this))},$.moveBottom=function(e){$("html, body").animate({scrollTop:$(document).height()},e??1e3)};let coefficientsForUP={freeCoefficient:2.834,hemoglobin:-.017,male:0,female:-1.295,hematohesia:-4.554,anamnesisGastrointestinalUpperBleeding:4.24,anamnesisGastrointestinalUndefinedBleeding:-18.167,melena:-1.279,coffeeVomit:3.777,bloodVomit:2.458},coefficientsForMIDDLE={freeCoefficient:3.717,hemoglobin:-.017,male:0,female:-1.3,hematohesia:-3.81,anamnesisGastrointestinalUpperBleeding:2.197,anamnesisGastrointestinalUndefinedBleeding:3.918,melena:-2.56,coffeeVomit:-18.471,bloodVomit:-1.265},hardness={1:"легкой",2:"средней",3:"тяжёлой"},localizationDefinition={1:"верхних",2:"средних",3:"нижних"},reasonsList={1:"варикозное расширение вен ЖКТ",2:"дивертикулы ЖКТ",3:"эрозивно-язвенные поражения тонкой/толстой кишки",4:"эрозивно-язвенные поражения верхних отделов ЖКТ",5:"сосудистые мальформации ЖКТ",6:"целиакия",7:"опухолевые заболевания ЖКТ"};function solveFor(e,s){return Math.exp(-(e.freeCoefficient+e.hemoglobin*s.hemoglobin+("female"===s.gender?e.female:e.male)+(s.hematohesia?e.hematohesia:0)+(s.anamnesisGastrointestinalUpperBleeding?e.anamnesisGastrointestinalUpperBleeding:0)+(s.anamnesisGastrointestinalUndefinedBleeding?e.anamnesisGastrointestinalUndefinedBleeding:0)+(s.melena?e.melena:0)+(s.coffeeVomit?e.coffeeVomit:0)+(s.bloodVomit?e.bloodVomit:0)))}function localizationResolver(e){let s=solveFor(coefficientsForUP,e),o=solveFor(coefficientsForMIDDLE,e);s=1/(1+s),o=1/(1+o);let t=1-(s+o);return{upProbability:s,middleProbability:o,downProbability:t,result:[1,2,3][[s,o,t].maxIndex()]}}function bleedReasonResolver(e){return console.log(this),e.v34||e.v35?1:e.v25||e.v27?2:e.v21||e.v23||e.v25||e.v30||e.v31||e.v32||e.v33?3:e.v21||e.v23||e.v24||e.v28||e.v32||e.v33?4:e.v28||e.v29||e.v34?5:e.v22||e.v31?6:7}function conclusionBuilder(e){return{explicit:void 0===e?null:e.explicit,bloodLossHardness:void 0===e?0:e.bloodLossHardness,DRICNecessity:void 0===e?0:e.DRICNecessity,localization:void 0===e?0:e.localization,reason:void 0===e?0:e.reason,andExplicit(e){return console.log("Определяю явность"),(e.bloodVomit||e.coffeeVomit||e.melena||e.hematohesia)&&(console.log("EXPLICIT"),this.explicit=!0),(e.collaptoidState&&e.gastrointestinalUcler&&e.stickySweat||e.paleSkin&&e.gastrointestinalUcler&&e.hemoglobinFalls||e.hiddenBleeding)&&(console.log("NOT EXPLICIT"),this.explicit=!1),this},andBloodLossHardnessLevel(e){return console.log("Определяю тяжесть кровопотери по данным: ",e),(e.erythrocytes>3.5)+(e.pulse<=80)+(e.bloodArterialPressure>110)+(e.hematocrit>30)>=2&&e.hemoglobin>100?this.bloodLossHardness=1:(e.erythrocytes>=2.5&&e.erythrocytes<=3.5)+(e.pulse>=80&&e.pulse<=100)+(e.bloodArterialPressure>=90&&e.bloodArterialPressure<=110)+(e.hematocrit>=25&&e.hematocrit<=30)>=2&&e.hemoglobin>=83&&e.hemoglobin<=100?this.bloodLossHardness=2:(e.erythrocytes<2.5)+(e.pulse>100)+(e.bloodArterialPressure<90)+(e.hematocrit<25)>=2&&e.hemoglobin<83&&(this.bloodLossHardness=3),this},andDRICNecessity(e){return(e.age>60)+(e.pulse>100)+(e.bloodArterialPressure<100)+(e.hemoglobin<100)+e.coffeeVomit+e.melena+e.lossConsciousness+e.additionalIllness>=4&&(this.DRICNecessity=3),this},predictLocalization(e){return this.localization=localizationResolver(e).result,this},setLocalization(e){return this.localization=e,this},andResolveReason(e){return console.log("Определяю причины",e),this.reason=bleedReasonResolver.call(this,e),this},getConclusion(){let e=this;return{explicit:e.explicit,bloodLossHardness:e.bloodLossHardness,DRICNecessity:e.DRICNecessity,localizationPredict:e.localization,reason:e.reason}},getTag(){return $(`<div class="alert alert-info my-2" role="alert">ЖКК <b>${this.explicit?"явное":"скрытое"}</b></div>`).append((()=>this.localization?`, локализованное в <b>${localizationDefinition[this.localization]}</b> отделах ЖКТ`:".")).append((()=>1===this.bloodLossHardness||2===this.bloodLossHardness?this.bloodLossHardness?`, <b>${hardness[this.bloodLossHardness]}</b> степени тяжести`:".":3===this.bloodLossHardness?this.bloodLossHardness?`, <b>${hardness[this.bloodLossHardness]}</b> степени`:".":void 0))}}}function collectData(){return{erythrocytes:parseFloat($("#erythrocytes").val().replaceAll(",",".")),hemoglobin:parseFloat($("#hemoglobin").val()),pulse:parseFloat($("#pulse").val()),hematocrit:parseFloat($("#hematocrit").val()),age:parseFloat($("#age").val()),coffeeVomit:$("#coffeeVomit").is(":checked"),melena:$("#melena").is(":checked"),lossConsciousness:$("#lossConsciousness").is(":checked"),bloodArterialPressure:parseFloat($("#bloodArterialPressure").val()),additionalIllness:$("#additionalIllness").is(":checked"),bloodVomit:$("#bloodVomit").is(":checked"),hematohesia:$("#hematohesia").is(":checked"),collaptoidState:$("#collaptoidState").is(":checked"),gastrointestinalUcler:$("#gastrointestinalUcler").is(":checked"),paleSkin:$("#paleSkin").is(":checked"),hemoglobinFalls:this.hemoglobin<100,hiddenBleeding:$("#hiddenBleeding").is(":checked"),stickySweat:$("#stickySweat").is(":checked"),gender:$('input[name="gender"]:checked').attr("id"),anamnesisGastrointestinalUpperBleeding:$("#anamnesisGastrointestinalUpperBleeding").is(":checked"),anamnesisGastrointestinalUndefinedBleeding:$("#anamnesisGastrointestinalUndefinedBleeding").is(":checked"),v21:$("#sign21").is(":checked"),v22:$("#sign22").is(":checked"),v23:$("#sign23").is(":checked"),v24:$("#sign24").is(":checked"),v25:$("#sign25").is(":checked"),v26:$("#sign26").is(":checked"),v27:$("#sign27").is(":checked"),v28:$("#sign28").is(":checked"),v29:$("#sign29").is(":checked"),v30:$("#sign30").is(":checked"),v31:$("#sign31").is(":checked"),v32:$("#sign32").is(":checked"),v33:$("#sign33").is(":checked"),v34:$("#sign34").is(":checked"),v35:$("#sign35").is(":checked"),hasResearchData:function(){return this.v21||this.v22||this.v23||this.v24||this.v25||this.v26||this.v27||this.v28||this.v29||this.v30||this.v31||this.v32||this.v33||this.v34||this.v35}}}"object"==typeof exports&&(module.exports={bleedReasonResolver:bleedReasonResolver,localizationResolver:localizationResolver}),(()=>{"use strict";function e(e,s){if(!/^\d+([,.]+\d+)+$/.test(e.value))return console.error("Неверное значение"),e.setCustomValidity("Введите десятичное значение"),s.preventDefault(),s.stopPropagation(),!1;console.log("Нет ошибки"),e.setCustomValidity("")}const s=document.querySelectorAll(".needs-validation");Array.from(s).forEach((s=>{s.addEventListener("submit",(o=>{s.checkValidity()||(o.preventDefault(),o.stopPropagation());const t=s.querySelector(".expectingDecimal");t.addEventListener("input",(function(s){e(s.currentTarget,s)})),e(t,o),s.classList.add("was-validated")}),!1)}))})();let linkPattern='<br><a href="#" type="button" class="text-black" data-bs-toggle="modal" data-bs-target="#additionalResearch">Ввести данные эндоскопического исследования</a>';function result(e){$("#questionBlock").toggleClass("d-inline d-none"),console.log("RESULT:",conclusion),0===e?$(".postConclusion").html($('<div class="alert alert-info my-2" role="alert">Консервативная терапия/наблюдение</div>')).parent().toggleClass("d-none d-block"):$(".postConclusion").html(conclusionBuilder(conclusion).setLocalization(e).andResolveReason(collectData()).getTag().clone().append(`, источником которого послужили : <b>${reasonsList[conclusion.reason]}</b>`).toggleClass("alert-info alert-primary")).parent().toggleClass("d-none d-block"),$.moveBottom()}function getSequence(){let e=$('<div class="alert alert-info d-inline-block me-1" role="alert" id="text">DDD</div>');return{context:this,step1:{run:function(){e.clone().html("ЭГДС").append(linkPattern).appendTo($("#adviceLine")),$("#question").html("Источник найден?"),console.log("STAGE 1")},yes:()=>result(1),no:()=>sequence.step2,research:!0},step2:{run:function(){e.clone().html("Колоноскопия").append(linkPattern).appendTo($("#adviceLine")),$("#question").html("Источник найден?"),console.log("STAGE 2")},yes:()=>result(3),no:()=>sequence.step3,research:!0},step3:{run:function(){$("#question").html("Кровотечение продолжается?"),console.log("STAGE 3")},yes:()=>sequence.step4,no:()=>sequence.step5,research:!1},step4:{run:function(){e.clone().html("КТ-ангиография и/или Инструментально-ассистированная энтероскопия и/или Сцинтиграфия и/или Хирургическое вмешательство").append(linkPattern).appendTo($("#adviceLine")),$("#question").html("Источник найден?"),console.log("STAGE 4")},yes:()=>result(2),no:()=>sequence.step5,research:!0},step5:{run:function(){e.clone().html("Rg с пассажем бария или КТЭ или МРЭ").appendTo($("#adviceLine")),$("#question").html("Имеется стриктура?"),console.log("STAGE 5")},yes:()=>sequence.step6,no:()=>sequence.step7,research:!1},step6:{run:function(){e.clone().html("Инструментально-ассистированная энтероскопия и/или Хирургическое вмешательство").append(linkPattern).appendTo($("#adviceLine")),console.log("STAGE 6"),result(2)},yes:()=>null,no:()=>null,research:!0},step7:{run:function(){e.clone().html("ВКЭ").append(linkPattern).appendTo($("#adviceLine")),$("#question").html("источник найден?"),console.log("STAGE 7")},yes:()=>sequence.step8,no:()=>result(0),research:!0},step8:{run:function(){console.log("STAGE 8")},yes:()=>result(0),no:()=>sequence.step6,research:!1}}}